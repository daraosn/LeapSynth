
<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="jquery.min.js"></script>
<script type="text/javascript" src="audioStream.js"></script>
<style>
#notes li { list-style: none; display: inline-block; width: 80px; padding: 30px 0; text-align: center; margin: 5px; background: #333; color: #eee }
#notes li:hover { background: #555 } 
</style>
</head>
<body>
<h1>HTML5 Audio API Wrapper</h1>
<ul id="notes">
    <li>C</li><li>C#</li><li>D</li><li>D#</li>
    <li>E</li><li>F</li><li>F#</li><li>G</li>
    <li>G#</li><li>A</li><li>A#</li><li>B</li><li>C</li>
</ul>
<script>
var playing = true;
var volume = 0.5;
var NO_NOTE = -100000;
var note = NO_NOTE;

audioStream(function(startSample, buffer, bufferSize, sampleRate) {
    for(var i = 0; i < bufferSize; i++) {
        var time = (startSample + i) / sampleRate;

        var sample = 0;
        if(note != NO_NOTE) {
            sample += sampleSin(noteFrequency(note + 5), time) * 0.1;
            sample += sampleSin(noteFrequency(note), time) * 0.2;
        }

        if(time % 0.25 < 0.01) sample += sampleSin(noteFrequency(10), time) * 0.1;
        if(time % 0.5 < 0.2) sample += sampleSin(noteFrequency(-25), time) * 0.1;
        if(time % 1 < 0.2) sample += sampleSin(noteFrequency(-30), time) * 0.1;

        buffer[i] = sample * (playing ? volume : 0);
    }
});

var noteFrequency = function(note) {
    return 440 * Math.pow(2, note / 12);
}

var sampleTriangle = function(freq, time) {
    var pos = (time * freq) % 1;
    if(pos > 0.75) return -1;
    if(pos > 0.5) return 0;
    if(pos > 0.25) return 1;
    return 0;
}

var sampleSin = function(freq, time) {
    return Math.sin(time * freq * Math.PI * 2);
}

var sampleSquare = function(freq, time) {
    var pos = (time * freq) % 1;
    if(pos > 0.5) return 1;
    return -1;
}

$("#notes li").hover(function(e) {
    note = $(this).prevAll().length - 21;
}, function(e) {
    note = NO_NOTE;
});
</script>
</body>
</html>